### 重定向的含义

点击页面“链接”的跳转，像这种是由浏览器的使用者主动发起的称为“主动跳转”

跳转是由服务器来发起的，浏览器使用者无法控制的，可以称为“被动跳转”，而这再 HTTP 协议里有个专业名词，叫做“重定向”（Redirection）

### 重定向的过程

响应字段“Location”，出现在响应报文里，并配合 301/302 状态码，会要求浏览器跳转到对应的 URI，而 Location 的值就是标记服务器要求重定向的 URI

重定向，实际上发送了两次 HTTP 请求，第一个返回 302，第二个就是重定向到 Location 指向的 URI

Location 的值，可以使用相对 URI 或者绝对 URI，如果跳转到站外，必须用绝对 URI

如果响应状态码 301/302 时，没有 Location 字段会显示 301 或 302 的默认页面 (需要前端配置)

### 重定向状态码

301
“永久重定向”（Moved Permanently），意思是原来 URI 已经“永久”地不存在了，以后的请求都必须使用新的 URI

浏览器遇到 301 时，就会做适当的优化。比如历史记录、更新书签，下次直接用新的 URI 访问。爬虫遇到 301 也会更新索引库，不在使用老的 URI

302
“临时重定向”（Moved Temporarily），意思是原 URI 处于“临时维护”状态，新的 URI“临时”启用

爬虫、浏览器遇到 302，不会做任何多余动作，只会执行简单的跳转

注意，303、307、308 这三个状态码接受程度偏低，有的浏览器或服务器可能不支持

### 重定向的应用场景

* “资源不可用”
  例如：域名变更、服务器变更、网站改版、服务器维护等，都会导致原 URI 指向的资源无法访问，为了避免出现 404，需要重定向跳转到新的 URI，提供服务
* “避免重复”
  让多个网址都跳转到一个 URI，增加访问入口的同时还不会增加额外的工作量 例如，有的网站申请多个域名，然后把他们重定向到主站
* “永久”
  如果域名、服务器、网站架构发生了大幅度的改变，原来 URI 不能用了，必须用 301 进行“永久重定向”，通知浏览器和搜索引擎更新地址
* “临时”
  原来 URI 在将来某个时间点会恢复正常，就使用 302，“临时“变更 URI 比如网站系统维护、“服务降级”（意思是临时关闭部分功能入口，保证核心服务正常可用）

### 重定向相关问题

1. 性能损耗
   1.1 重定向机制导致一个跳转会产生两次请求 站内重定向还好，可以长连接复用，但是站外重定向要开两个请求，如果碰上网络连接质量差，会严重影响用户体验
2. 循环跳转
   2.1 如果重定向策略有问题，可能会导致无限循环 所以，HTTP 协议规定，浏览器必须具有检查“循环跳转”的能力，能及时发现、停止跳转并给出错误提示
   2.2 比如：Chrome 会给出“该网页无法正常运作 ERR_TOO_MANY_REDIRECTS”这样的提示

### 小结
1. 重定向是服务器发起的跳转，要求客户端改用新的 URI 重新发起请求，通常会自动进行，用户是无感知的
2. 301/302 是最常用的重定向状态码，分别是“永久重定向”和“临时重定向”
3. 响应头字段 Location 指示了要跳转的 URI，可以用绝对或相对的形式
4. 重定向可以把一个 URI 指向拎一个 URI，也可以把多个 URI 指向同一个 URI，用途很多
5. 使用重定向时需要当心性能损耗，还要避免出现循环跳转


### 问题
1. 301 和 302 非常相似，试着用自己的理解再描述一下两者的异同点
   301 是废弃原来 URI，使用新的 URI，并且使得浏览器和爬虫更新对应的记录
   302 是临时更换 URI，过一段时间会恢复原来 URI 的访问，浏览器和爬虫都不会做额外的操作
2. 能结合自己的实际情况，再列出几个应当使用重定向的场景吗？
   功能服务下架，重定向到首页
   权限校验，比如普通用户不能进入权限管理页面，就使用提示用户并重定向
   未登录用户重定向到登录页
